## üì° –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: Headers-Only —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: Quaxis Core = –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –Ω–æ–¥–∞

–ù–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π! –û–¥–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–µ–ª–∞–µ—Ç –≤—Å—ë:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Å–µ—Ç—å—é Bitcoin
- –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏
- –ú–∞–π–Ω–∏—Ç
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏

---

## Headers-Only Sync ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –º–∞–π–Ω–∏–Ω–≥–∞!

### –ß—Ç–æ —Ö—Ä–∞–Ω–∏–º (80 –±–∞–π—Ç –Ω–∞ –±–ª–æ–∫):
```cpp
struct BlockHeader {
    int32_t  version;      // –í–µ—Ä—Å–∏—è –±–ª–æ–∫–∞
    uint256  prev_hash;    // –•–µ—à –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –±–ª–æ–∫–∞
    uint256  merkle_root;  // –ö–æ—Ä–µ–Ω—å –¥–µ—Ä–µ–≤–∞ –ú–µ—Ä–∫–ª–∞
    uint32_t timestamp;    // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
    uint32_t bits;         // –¢–µ–∫—É—â–∏–π difficulty (target)
    uint32_t nonce;        // Nonce
};
```

### –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:
- 870,000 –±–ª–æ–∫–æ–≤ √ó 80 –±–∞–π—Ç = **~70 MB**
- –° –∏–Ω–¥–µ–∫—Å–∞–º–∏: **~90 MB –Ω–∞ –¥–∏—Å–∫–µ**
- –í RAM: **~100-200 MB**

### –í—Ä–µ–º—è –Ω–∞—á–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- 2000 headers –∑–∞ –∑–∞–ø—Ä–æ—Å (–ø—Ä–æ—Ç–æ–∫–æ–ª Bitcoin)
- **1-3 –º–∏–Ω—É—Ç—ã** –¥–æ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –º–∞–π–Ω–∏–Ω–≥—É!

---

## –ß—Ç–æ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑ –ø–æ–ª–Ω—ã—Ö –±–ª–æ–∫–æ–≤:

‚úÖ PoW –∫–∞–∂–¥–æ–≥–æ header (hash < target)  
‚úÖ –¶–µ–ø–æ—á–∫–∞ prev_hash (–∫–∞–∂–¥—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π)  
‚úÖ Difficulty retarget (–∫–∞–∂–¥—ã–µ 2016 –±–ª–æ–∫–æ–≤)  
‚úÖ Timestamp (–Ω–µ —Å–∏–ª—å–Ω–æ –≤ –±—É–¥—É—â–µ–º, > median 11 –±–ª–æ–∫–æ–≤)  
‚úÖ –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π chainwork (–≤—ã–±–∏—Ä–∞–µ–º —Ü–µ–ø—å —Å max work)  

### –≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:
‚úÖ –ó–Ω–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π tip —Ü–µ–ø–∏  
‚úÖ –ü–æ–ª—É—á–∏—Ç—å prev_block_hash –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞  
‚úÖ –ó–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π difficulty/target  
‚úÖ –î–µ—Ç–µ–∫—Ç–∏—Ç—å reorg (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ü–µ–ø–∏)  
‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–π –±–ª–æ–∫ –≤ —Å–µ—Ç—å  

---

## –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞

–ö–æ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏–º –≤–∞–ª–∏–¥–Ω—ã–π nonce:
```cpp
struct Block {
    BlockHeader header;       // 80 –±–∞–π—Ç
    varint tx_count;          // 1 (—Ç–æ–ª—å–∫–æ coinbase)
    Transaction coinbase;     // ~110 –±–∞–π—Ç
};
// –ò–¢–û–ì–û: ~200 –±–∞–π—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Å–µ—Ç—å!
```

P2P –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
1. `inv(MSG_BLOCK, block_hash)` ‚Üí –≤—Å–µ–º peers
2. Peers –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç: `getdata(MSG_BLOCK, block_hash)`
3. –û—Ç–≤–µ—á–∞–µ–º: `block(header + coinbase)`

---

## Checkpoints –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

```cpp
// –•–∞—Ä–¥–∫–æ–¥–∏–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –±–ª–æ–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Ä–µ–ª–∏–∑–∞—Ö)
constexpr std::array<Checkpoint, N> MAINNET_CHECKPOINTS = {{
    {0,       "000000000019d6689c..."_hash, ...},  // Genesis
    {100000,  "000000000003ba27aa..."_hash, ...},
    // ...
    {870000,  "0000000000000000..."_hash, ...},    // –ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π
}};
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç** ‚Äî –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º PoW –¥–æ checkpoint
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥—Å—É–Ω—É—Ç—å —Ñ–µ–π–∫–æ–≤—É—é —Ü–µ–ø—å
- **–ò–∑–≤–µ—Å—Ç–Ω—ã–π difficulty** ‚Äî —Å—á–∏—Ç–∞–µ–º –æ—Ç checkpoint

---

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```
quaxis-core/src/
‚îú‚îÄ‚îÄ primitives/
‚îÇ   ‚îú‚îÄ‚îÄ block.hpp           # BlockHeader, Block
‚îÇ   ‚îî‚îÄ‚îÄ transaction.hpp     # Transaction (–¥–ª—è coinbase)
‚îú‚îÄ‚îÄ consensus/
‚îÇ   ‚îú‚îÄ‚îÄ params.hpp          # Mainnet/Testnet –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ pow.hpp             # PoW –ø—Ä–æ–≤–µ—Ä–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ difficulty.hpp      # Difficulty retarget
‚îú‚îÄ‚îÄ chain/
‚îÇ   ‚îú‚îÄ‚îÄ headers_db.hpp      # –•—Ä–∞–Ω–µ–Ω–∏–µ headers (~90 MB)
‚îÇ   ‚îú‚îÄ‚îÄ chain_state.hpp     # –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ü–µ–ø–∏
‚îÇ   ‚îî‚îÄ‚îÄ reorg_handler.hpp   # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
‚îú‚îÄ‚îÄ sync/                   # ‚Üê –ù–û–í–´–ô –ú–û–î–£–õ–¨
‚îÇ   ‚îú‚îÄ‚îÄ headers_sync.hpp    # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è headers
‚îÇ   ‚îú‚îÄ‚îÄ initial_sync.hpp    # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ checkpoints.hpp     # –•–∞—Ä–¥–∫–æ–¥ checkpoints
‚îú‚îÄ‚îÄ p2p/
‚îÇ   ‚îú‚îÄ‚îÄ network.hpp         # io_uring/epoll —Å–µ—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ peer_manager.hpp    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ messages.hpp        # P2P –ø—Ä–æ—Ç–æ–∫–æ–ª Bitcoin
‚îÇ   ‚îî‚îÄ‚îÄ block_relay.hpp     # –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
‚îú‚îÄ‚îÄ mining/                 # –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–π–Ω–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ job_manager.hpp
‚îÇ   ‚îú‚îÄ‚îÄ coinbase.hpp
‚îÇ   ‚îî‚îÄ‚îÄ block_builder.hpp
‚îî‚îÄ‚îÄ asic/                   # –°–≤—è–∑—å —Å ASIC
    ‚îú‚îÄ‚îÄ protocol.hpp
    ‚îî‚îÄ‚îÄ connection.hpp
```

---

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ P2P —Å–æ–æ–±—â–µ–Ω–∏—è

**–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**
- `version` / `verack` ‚Äî handshake
- `getaddr` / `addr` ‚Äî –ø–æ–∏—Å–∫ peers
- `getheaders` / `headers` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è headers
- `inv` / `getdata` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö
- `sendheaders` ‚Äî –ø—Ä–æ—Å–∏–º —Å–ª–∞—Ç—å headers —Å—Ä–∞–∑—É
- `sendcmpct` ‚Äî Compact Blocks (BIP 152)
- `ping` / `pong` ‚Äî keepalive

**–ù–ï –Ω—É–∂–Ω–æ:**
- `getblocks` / `block` ‚Äî –ø–æ–ª–Ω—ã–µ –±–ª–æ–∫–∏ –Ω–µ –∫–∞—á–∞–µ–º
- `tx` / `mempool` ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –Ω—É–∂–Ω—ã
- `filterload` / `merkleblock` ‚Äî SPV —Ñ–∏–ª—å—Ç—Ä—ã

---

## –ò—Ç–æ–≥–æ: –†–µ—Å—É—Ä—Å—ã Quaxis Core Lite

| –†–µ—Å—É—Ä—Å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| RAM | ~100-200 MB |
| Disk | ~100 MB |
| Network | 8-16 P2P connections |
| –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | 1-3 –º–∏–Ω—É—Ç—ã |
| –û—Ç–ø—Ä–∞–≤–∫–∞ –±–ª–æ–∫–∞ | ~200 –±–∞–π—Ç |